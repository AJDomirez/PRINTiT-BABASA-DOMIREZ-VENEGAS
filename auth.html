<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Print-IT Â· Auth (fixed)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:linear-gradient(135deg,#eef5ff,#f8fbff);font-family:Inter,system-ui,Arial}
    .tab-btn.active{background:#1d4ed8;color:#fff}
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

  <div class="w-full max-w-md bg-white rounded-2xl shadow-2xl p-6 sm:p-8">
    <!-- Logo -->
    <div class="flex flex-col items-center gap-1 mb-5">
      <img src="logo-placeholder.png" alt="Logo" class="w-14 h-14 rounded-full bg-gray-100 object-cover shadow-sm" />
      <h1 class="text-2xl font-extrabold text-sky-600">Print-IT</h1>
      <p class="text-xs text-gray-500 text-center">Your trusted printing service platform</p>
    </div>

    <!-- Tabs -->
    <div class="flex gap-2 bg-slate-100 rounded-xl p-1 mb-5">
      <button id="tab-signin" class="tab-btn active w-1/4 py-2 rounded-lg text-sm font-medium">Sign In</button>
      <button id="tab-signup" class="tab-btn w-1/4 py-2 rounded-lg text-sm font-medium">Sign Up</button>
      <button id="tab-vendor-login" class="tab-btn w-1/4 py-2 rounded-lg text-sm font-medium">Vendor</button>
      <button id="tab-vendor-signup" class="tab-btn w-1/4 py-2 rounded-lg text-sm font-medium">Vendor Reg</button>
    </div>

    <!-- Page-level error -->
    <div id="pageError" class="hidden text-sm text-red-600 mb-3"></div>

    <!-- Forms -->
    <div id="forms">
      <!-- Customer Sign In -->
      <form id="form-signin" class="space-y-3">
        <div>
          <label class="text-xs text-gray-600">Email</label>
          <input id="signin-email" type="email" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-sky-200" placeholder="Enter your email"/>
        </div>
        <div>
          <label class="text-xs text-gray-600">Password</label>
          <input id="signin-password" type="password" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-sky-200" placeholder="Enter your password"/>
        </div>
        <button class="w-full bg-sky-500 text-white py-2 rounded-lg font-semibold hover:bg-sky-600">Login</button>
        <p id="signin-err" class="text-xs text-red-500 hidden"></p>
      </form>

      <!-- Customer Sign Up -->
      <form id="form-signup" class="space-y-3 hidden">
        <div>
          <label class="text-xs text-gray-600">Full name</label>
          <input id="signup-name" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-sky-200" placeholder="Your full name"/>
        </div>
        <div>
          <label class="text-xs text-gray-600">Email</label>
          <input id="signup-email" type="email" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-sky-200" placeholder="you@example.com"/>
        </div>
        <div>
          <label class="text-xs text-gray-600">Password</label>
          <input id="signup-password" type="password" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-sky-200" placeholder="Choose a secure password"/>
        </div>
        <button class="w-full bg-sky-500 text-white py-2 rounded-lg font-semibold hover:bg-sky-600">Create account</button>
        <p id="signup-err" class="text-xs text-red-500 hidden"></p>
      </form>

      <!-- Vendor Login -->
      <form id="form-vendor-login" class="space-y-3 hidden">
        <div>
          <label class="text-xs text-gray-600">Email</label>
          <input id="vendor-email" type="email" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-200" placeholder="vendor email"/>
        </div>
        <div>
          <label class="text-xs text-gray-600">Password</label>
          <input id="vendor-password" type="password" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-200" placeholder="Enter your password"/>
        </div>
        <button class="w-full bg-emerald-500 text-white py-2 rounded-lg font-semibold hover:bg-emerald-600">Vendor Login</button>
        <p id="vendor-login-err" class="text-xs text-red-500 hidden"></p>
      </form>

      <!-- Vendor Registration -->
      <form id="form-vendor-signup" class="space-y-3 hidden">
        <div>
          <label class="text-xs text-gray-600">Shop name</label>
          <input id="vreg-shop" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-200" placeholder="Your shop name"/>
        </div>
        <div>
          <label class="text-xs text-gray-600">Owner name</label>
          <input id="vreg-owner" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-200" placeholder="Owner full name"/>
        </div>
        <div>
          <label class="text-xs text-gray-600">Address</label>
          <input id="vreg-address" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-200" placeholder="Shop address"/>
        </div>
        <div>
          <label class="text-xs text-gray-600">Email</label>
          <input id="vreg-email" type="email" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-200" placeholder="you@shop.com"/>
        </div>
        <div>
          <label class="text-xs text-gray-600">Password</label>
          <input id="vreg-password" type="password" required class="w-full mt-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-200" placeholder="Choose a secure password"/>
        </div>
        <button class="w-full bg-emerald-500 text-white py-2 rounded-lg font-semibold hover:bg-emerald-600">Register vendor</button>
        <p id="vreg-err" class="text-xs text-red-500 hidden"></p>
      </form>
    </div>
  </div>

  <!-- Tabs (no dependencies; works even if Firebase fails) -->
  <script>
    (function () {
      const map = {
        "tab-signin": "form-signin",
        "tab-signup": "form-signup",
        "tab-vendor-login": "form-vendor-login",
        "tab-vendor-signup": "form-vendor-signup"
      };
      function showForm(tabId){
        for (const id in map){
          document.getElementById(id).classList.toggle("active", id===tabId);
          document.getElementById(map[id]).classList.toggle("hidden", id!==tabId);
        }
      }
      Object.keys(map).forEach(id => {
        document.getElementById(id).addEventListener("click", () => showForm(id));
      });
      showForm("tab-signin");
    })();
  </script>

  <!-- Firebase (inline config; modular SDK) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ðŸ”§ Inline config (same as the rest of your site)
    const firebaseConfig = {
      apiKey: "AIzaSyBWEsXe-FUspLVrQbWx9W9fdJjhEZxzs-c",
      authDomain: "printit-web.firebaseapp.com",
      databaseURL: "https://printit-web-default-rtdb.firebaseio.com",
      projectId: "printit-web",
      storageBucket: "printit-web.firebasestorage.app",
      messagingSenderId: "432024876127",
      appId: "1:432024876127:web:03f56715a495f801cd97ea",
      measurementId: "G-MLX52XE058"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const showErr = (id,msg)=>{ const el=document.getElementById(id); el.textContent=msg; el.classList.remove("hidden"); };
    const hideErr = (id)=> document.getElementById(id).classList.add("hidden");

    // Customer sign-in â†’ home.html
    document.getElementById("form-signin").addEventListener("submit", async (e) => {
      e.preventDefault(); hideErr("signin-err");
      try{
        await signInWithEmailAndPassword(
          auth,
          document.getElementById("signin-email").value.trim(),
          document.getElementById("signin-password").value
        );
        window.location.href = "home.html";
      }catch(err){ showErr("signin-err", err.message); }
    });

    // Customer sign-up â†’ users/{uid} â†’ home.html
    document.getElementById("form-signup").addEventListener("submit", async (e) => {
      e.preventDefault(); hideErr("signup-err");
      try{
        const email = document.getElementById("signup-email").value.trim();
        const password = document.getElementById("signup-password").value;
        const name = document.getElementById("signup-name").value.trim();
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        await setDoc(doc(db,"users",cred.user.uid), {
          fullName:name, email, role:"customer", createdAt:new Date().toISOString()
        });
        window.location.href = "home.html";
      }catch(err){ showErr("signup-err", err.message); }
    });

    // Vendor login â†’ verify vendors/{uid} exists â†’ vendor-dashboard.html
    document.getElementById("form-vendor-login").addEventListener("submit", async (e) => {
      e.preventDefault(); hideErr("vendor-login-err");
      try{
        const email = document.getElementById("vendor-email").value.trim();
        const password = document.getElementById("vendor-password").value;
        const cred = await signInWithEmailAndPassword(auth, email, password);
        const snap = await getDoc(doc(db,"vendors",cred.user.uid));
        if (!snap.exists()) { showErr("vendor-login-err","This account is not registered as a vendor."); return; }
        window.location.href = "vendor-dashboard.html";
      }catch(err){ showErr("vendor-login-err", err.message); }
    });

    // Vendor registration â†’ users/{uid} & vendors/{uid} â†’ vendor-dashboard.html
    document.getElementById("form-vendor-signup").addEventListener("submit", async (e) => {
      e.preventDefault(); hideErr("vreg-err");
      try{
        const email = document.getElementById("vreg-email").value.trim();
        const password = document.getElementById("vreg-password").value;
        const shopName = document.getElementById("vreg-shop").value.trim();
        const ownerName = document.getElementById("vreg-owner").value.trim();
        const address = document.getElementById("vreg-address").value.trim();

        const cred = await createUserWithEmailAndPassword(auth, email, password);
        const uid = cred.user.uid;
        const vendorData = { email, shopName, ownerName, address, isApproved:true, mapLink:"", createdAt:new Date().toISOString() };
        await setDoc(doc(db,"users",uid), { ...vendorData, role:"vendor" });
        await setDoc(doc(db,"vendors",uid), vendorData);

        window.location.href = "vendor-dashboard.html";
      }catch(err){ showErr("vreg-err", err.message); }
    });
  </script>
</body>
</html>

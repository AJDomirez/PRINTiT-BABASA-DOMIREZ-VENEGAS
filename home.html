<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Print-IT ¬∑ Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:#f7fafc}
    .card{border-radius:1rem;box-shadow:0 8px 22px rgba(15,23,42,.06)}
    .img-wrap{border-top-left-radius:1rem;border-top-right-radius:1rem;overflow:hidden;background:#eef2f7}
    .badge{font-size:.75rem}
    .star{color:#fbbf24}
    .truncate-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .skeleton{position:relative;overflow:hidden;background:#e5e7eb}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,transparent,rgba(255,255,255,.55),transparent);animation:shimmer 1.2s infinite}
    @keyframes shimmer{to{transform:translateX(100%)}}
  </style>
</head>
<body class="min-h-screen">

  <!-- Top bar -->
  <header class="bg-white sticky top-0 z-30 border-b">
    <div class="max-w-7xl mx-auto px-5 py-4 flex items-center gap-4">
      <!-- Logo -->
      <div class="flex items-center gap-2">
        <img src="logo-placeholder.png" alt="logo" class="w-9 h-9 rounded-md bg-gray-100 object-cover">
        <span class="text-lg font-semibold text-sky-600">Print-IT</span>
      </div>

      <!-- Search -->
      <div class="flex-1">
        <div class="max-w-2xl mx-auto relative">
          <span class="absolute left-4 top-[10px] text-gray-400">üìç</span>
          <input id="searchInput" placeholder="Search for printing services near you..."
                 class="w-full rounded-full border bg-white px-12 py-2.5 focus:outline-none focus:ring-2 focus:ring-sky-200" />
          <span class="absolute right-4 top-[10px] text-gray-400">üîé</span>
        </div>
      </div>

      <!-- Logout -->
      <button id="logoutBtn"
        class="ml-auto inline-flex items-center gap-2 bg-white border px-3 py-2 rounded-md text-gray-700 hover:bg-gray-50">
        <span>üö™</span> Logout
      </button>
    </div>
  </header>

  <!-- Heading -->
  <section class="max-w-7xl mx-auto px-5 py-6">
    <h2 class="text-2xl font-semibold text-slate-800">Printing Services Near You</h2>
    <p class="text-gray-500">Find the best printing solutions in your area</p>
  </section>

  <!-- Vendor grid -->
  <main class="max-w-7xl mx-auto px-5 pb-12">
    <div id="grid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
    <div id="stateBox" class="text-center text-gray-500 py-16">Loading shops...</div>
  </main>

  <!-- Firebase + page logic -->
  <script type="module">
    // expects ./firebase-config.js exporting: export const firebaseConfig = { ... }
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import {
      getFirestore, collection, onSnapshot, doc, getDocs
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { firebaseConfig } from "./firebase-config.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const grid = document.getElementById("grid");
    const stateBox = document.getElementById("stateBox");
    const searchInput = document.getElementById("searchInput");

    // Auth guard
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "auth.html";
        return;
      }
    });

    // Sign out
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "login.html";
    });

    // Vendors + images
    let vendors = [];
    const heroCache = new Map(); // vendorId -> imageUrl

    onSnapshot(collection(db, "vendors"), (snap) => {
      vendors = [];
      snap.forEach((d) => vendors.push({ id: d.id, ...d.data() }));
      render();
      // after first render, lazily resolve missing images
      vendors.forEach(v => ensureVendorImage(v));
    }, (err) => {
      stateBox.textContent = "Failed to load vendors: " + err.message;
    });

    // Find an image for the vendor:
    // 1) vendor.shopImage or vendor.imageUrl
    // 2) first service.imageUrl (if any)
    // 3) fallback placeholder
    const FALLBACK =
      "https://images.unsplash.com/photo-1517694712202-14dd9538aa97?q=80&w=1200&auto=format&fit=crop";

    function getVendorImageSync(v) {
      return v.shopImage || v.imageUrl || heroCache.get(v.id) || null;
    }

    async function ensureVendorImage(v) {
      if (getVendorImageSync(v)) return; // already have one
      try {
        // look into services subcollection for first image
        const srvSnap = await getDocs(collection(db, "vendors", v.id, "services"));
        for (const s of srvSnap.docs) {
          const d = s.data();
          if (d.imageUrl) {
            heroCache.set(v.id, d.imageUrl);
            // update the card if it's on screen
            const img = document.querySelector(`[data-vid="${v.id}"] .heroimg`);
            if (img) img.src = d.imageUrl;
            return;
          }
        }
        // if no service had image, set fallback so we don't re-query
        heroCache.set(v.id, FALLBACK);
      } catch(e) {
        console.warn("image lookup failed for vendor", v.id, e.message);
        heroCache.set(v.id, FALLBACK);
      }
    }

    // Search filter
    searchInput.addEventListener("input", render);

    function render() {
      const q = searchInput.value.trim().toLowerCase();
      let list = vendors.slice();

      if (q) {
        list = list.filter(v => {
          const hay = `${v.shopName||""} ${v.address||""} ${v.description||v.about||""}`.toLowerCase();
          return hay.includes(q);
        });
      }

      grid.innerHTML = "";
      if (!list.length) {
        stateBox.textContent = vendors.length ? "No shops match your search." : "Loading shops...";
        stateBox.classList.remove("hidden");
        return;
      }
      stateBox.classList.add("hidden");

      list.forEach(v => grid.appendChild(card(v)));
    }

    function card(v) {
      const wrap = document.createElement("article");
      wrap.className = "card bg-white overflow-hidden flex flex-col";
      wrap.setAttribute("data-vid", v.id);

      const imgUrl = getVendorImageSync(v) || FALLBACK;

      wrap.innerHTML = `
        <div class="img-wrap">
          <img src="${imgUrl}" alt="${escapeHTML(v.shopName || "Shop image")}"
               class="heroimg w-full h-40 object-cover ${imgUrl ? "" : "skeleton"}" />
        </div>
        <div class="p-4 flex-1 flex flex-col gap-2">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold text-slate-800 leading-tight">${escapeHTML(v.shopName || "Unnamed Shop")}</h3>
            <div class="flex items-center gap-1 text-sm">
              <span class="star">‚òÖ</span><span class="text-gray-700">${typeof v.rating === "number" ? v.rating.toFixed(1) : (v.rating || "4.6")}</span>
            </div>
          </div>

          <p class="text-sm text-gray-600 truncate-2">${escapeHTML(v.description || v.about || "Professional printing services with quick turnaround.")}</p>

          <div class="mt-1 flex items-center justify-between text-xs">
            <div class="flex items-center gap-4 text-gray-500">
              <span>üìç ${v.address ? escapeHTML(v.address) : "Address not provided"}</span>
            </div>
            <span class="badge ${v.isOpen===false ? 'text-red-500' : 'text-emerald-600'}">
              ${v.isOpen===false ? (v.closesAt ? `Closes at ${escapeHTML(v.closesAt)}` : 'Closed') : (v.closesAt ? `Open ¬∑ Closes at ${escapeHTML(v.closesAt)}` : 'Open now')}
            </span>
          </div>

          <button class="mt-3 bg-sky-600 hover:bg-sky-700 text-white py-2 rounded-md font-medium"
                  onclick="window.location.href='shop.html?id=${v.id}'">View Store</button>
        </div>
        <style>
  /* === Professional UI Enhancements (No Code Changes Needed) === */

  /* Smooth global transitions */
  * {
    transition: all 0.25s ease-in-out;
  }

  /* Subtle hover lift on cards */
  .card {
    transform: translateY(0);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 26px rgba(0, 0, 0, 0.1);
  }

  /* Hero image animation */
  .heroimg {
    transition: transform 0.6s ease, filter 0.3s ease;
  }
  .card:hover .heroimg {
    transform: scale(1.05);
    filter: brightness(1.05);
  }

  /* Smooth button glow effect */
  button {
    transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
  }
  button:hover {
    box-shadow: 0 0 0 4px rgba(56, 189, 248, 0.3);
    transform: translateY(-2px);
  }
  button:active {
    transform: scale(0.98);
  }

  /* Search bar focus animation */
  #searchInput {
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
  }
  #searchInput:focus {
    box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.3);
    border-color: #38bdf8;
  }

  /* Fade-in animation for grid items */
  #grid article {
    opacity: 0;
    transform: translateY(10px);
    animation: fadeInUp 0.5s ease forwards;
  }
  #grid article:nth-child(1) { animation-delay: 0.05s; }
  #grid article:nth-child(2) { animation-delay: 0.1s; }
  #grid article:nth-child(3) { animation-delay: 0.15s; }
  #grid article:nth-child(4) { animation-delay: 0.2s; }
  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Make header sticky effect more elegant */
  header {
    backdrop-filter: blur(8px);
    background-color: rgba(255, 255, 255, 0.85);
  }

  /* Hover glow on shop title */
  .card h3 {
    transition: color 0.2s ease, text-shadow 0.3s ease;
  }
  .card:hover h3 {
    color: #0284c7;
    text-shadow: 0 0 6px rgba(2, 132, 199, 0.25);
  }

  /* Tag badges animation */
  .badge {
    transition: color 0.3s ease, transform 0.3s ease;
  }
  .card:hover .badge {
    transform: scale(1.05);
  }

  /* Smooth page fade-in on load */
  body {
    opacity: 0;
    animation: fadeBody 0.4s ease forwards;
  }
  @keyframes fadeBody {
    to { opacity: 1; }
  }
</style>
<style>
  /* === Pro-Level Box/Card Design Enhancements === */

  /* Elegant layered card shadow */
  .card {
    background: linear-gradient(180deg, #ffffff, #f9fafb);
    border: 1px solid rgba(226, 232, 240, 0.9);
    box-shadow:
      0 1px 3px rgba(15, 23, 42, 0.05),
      0 4px 12px rgba(15, 23, 42, 0.08),
      0 12px 24px rgba(15, 23, 42, 0.03);
    border-radius: 1rem;
    transition: all 0.35s ease;
  }

  /* Hover pop with glow */
  .card:hover {
    transform: translateY(-6px) scale(1.01);
    box-shadow:
      0 4px 6px rgba(15, 23, 42, 0.05),
      0 12px 20px rgba(15, 23, 42, 0.08),
      0 20px 40px rgba(56, 189, 248, 0.2);
    border-color: rgba(56, 189, 248, 0.3);
  }

  /* Image wrapper aesthetic */
  .img-wrap {
    position: relative;
    background: linear-gradient(145deg, #e2e8f0, #f8fafc);
  }

  /* Subtle overlay on image for readability */
  .img-wrap::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0) 60%, rgba(0,0,0,0.08) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    border-top-left-radius: 1rem;
    border-top-right-radius: 1rem;
  }
  .card:hover .img-wrap::after {
    opacity: 1;
  }

  /* Card inner content polish */
  .card .p-4 {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(4px);
  }

  /* Hover highlight for card content */
  .card:hover .p-4 {
    background: rgba(255, 255, 255, 1);
  }

  /* Shop name glow effect */
  .card h3 {
    font-weight: 600;
    color: #0f172a;
    letter-spacing: 0.01em;
  }
  .card:hover h3 {
    color: #0369a1;
    text-shadow: 0 0 6px rgba(56, 189, 248, 0.25);
  }

  /* Soft badge styling */
  .badge {
    background: rgba(240, 249, 255, 0.7);
    padding: 0.2rem 0.5rem;
    border-radius: 0.375rem;
    font-weight: 500;
    border: 1px solid rgba(56, 189, 248, 0.15);
  }

  /* Hover glow on buttons */
  button {
    position: relative;
    overflow: hidden;
    z-index: 1;
  }
  button::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, rgba(255,255,255,0.3), transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 0;
  }
  button:hover::before {
    opacity: 1;
  }

  /* Glow behind active card */
  .card:hover::before {
    content: "";
    position: absolute;
    inset: -3px;
    border-radius: 1.1rem;
    background: linear-gradient(135deg, rgba(56,189,248,0.3), rgba(125,211,252,0.1));
    z-index: -1;
    animation: glowpulse 1.8s ease-in-out infinite alternate;
  }

  @keyframes glowpulse {
    from { opacity: 0.5; transform: scale(1); }
    to { opacity: 1; transform: scale(1.02); }
  }

  /* Subtle hover animation for text & icons */
  .card:hover .text-gray-600,
  .card:hover .text-gray-500 {
    color: #0369a1;
  }

  /* Slight tilt effect when hovering */
  .card {
    transform-style: preserve-3d;
  }
  .card:hover {
    transform: rotateX(2deg) rotateY(-1deg) translateY(-5px);
  }

  /* Smooth shadow transition for grid */
  #grid {
    transition: all 0.3s ease;
  }
</style>


      `;
      return wrap;
    }

    function escapeHTML(s){
      return String(s||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
    }
    
    
  </script>
</body>
</html>
